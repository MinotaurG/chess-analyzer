# Chess Analyzer - Project Context

> **Last Updated**: $(date +%Y-%m-%d)
> **Status**: Early Development
> **Rust Level**: Learning

---

## ğŸ¯ Project Goal

A CLI tool to analyze chess games from PGN files using Stockfish engine.
Learning Rust through a practical project.

---

## ğŸ“ Architecture
chess-analyzer/
â”œâ”€â”€ src/
â”‚ â”œâ”€â”€ main.rs # CLI entry point (analyze, eval, test-engine commands)
â”‚ â”œâ”€â”€ lib.rs # Library root, basic position analysis
â”‚ â”œâ”€â”€ parser/
â”‚ â”‚ â”œâ”€â”€ mod.rs # Module exports
â”‚ â”‚ â””â”€â”€ pgn.rs # PGN parsing (uses pgn-reader crate)
â”‚ â””â”€â”€ engine/
â”‚ â”œâ”€â”€ mod.rs # Module exports (EMPTY - needs fix)
â”‚ â”œâ”€â”€ analysis.rs # Evaluation/PositionAnalysis types
â”‚ â””â”€â”€ stockfish.rs # Stockfish UCI protocol interface
â””â”€â”€ data/
â””â”€â”€ sample.pgn # Test file



---

## ğŸ”§ Current State

### Working
- [x] PGN file parsing with pgn-reader
- [x] Position tracking through games (using shakmaty)
- [x] Stockfish communication via UCI protocol
- [x] Basic CLI structure (analyze, eval, test-engine)
- [x] Evaluation types (Centipawns, Mate)

### Broken/Incomplete
- [ ] `engine/mod.rs` is empty - doesn't export submodules
- [ ] `convert_san_to_uci()` returns empty Vec - game analysis broken
- [ ] Cargo.toml has `edition = "2024"` (should be "2021")

### Not Started
- [ ] Move-by-move analysis with mistake detection
- [ ] Opening classification
- [ ] Game report generation
- [ ] Export analysis results

---

## ğŸ§  Key Decisions Made

| Decision | Rationale |
|----------|-----------|
| Use `pgn-reader` crate | Streaming parser, memory efficient |
| Use `shakmaty` crate | Pure Rust, no dependencies, fast |
| Stockfish via subprocess | Standard approach, UCI protocol |
| Visitor pattern for PGN | Required by pgn-reader API |

---

## ğŸ“š Concepts to Understand

- **UCI Protocol**: Universal Chess Interface - text protocol for engine communication
- **FEN**: Forsyth-Edwards Notation - string representation of board position
- **SAN**: Standard Algebraic Notation - human readable moves (e4, Nf3)
- **PGN**: Portable Game Notation - file format for chess games
- **Centipawns**: 1/100th of a pawn value (100cp = 1 pawn advantage)

---

## ğŸ› Known Bugs

1. **Edition typo** in Cargo.toml
2. **Empty mod.rs** in engine/ - compile will fail on `use chess_analyzer::engine::StockfishEngine`
3. **SANâ†’UCI conversion** missing - can't send game moves to Stockfish

---

## ğŸ“ Next Steps (Priority Order)

1. Fix Cargo.toml edition
2. Fix engine/mod.rs exports
3. Implement SAN to UCI conversion
4. Add move-by-move analysis
5. Detect blunders/mistakes/inaccuracies

---

## ğŸ”— Dependencies

| Crate | Version | Purpose |
|-------|---------|---------|
| pgn-reader | 0.29.0 | Parse PGN files |
| shakmaty | 0.30.0 | Chess logic, move validation |

---

## ğŸ’» Commands

```bash
# Build
cargo build

# Test
cargo test

# Run
cargo run -- analyze data/sample.pgn
cargo run -- eval "rnbqkbnr/pppppppp/8/8/4P3/8/PPPP1PPP/RNBQKBNR b KQkq - 0 1"
cargo run -- test-engine

# Test with Stockfish (requires: sudo apt install stockfish)
cargo test -- --ignored
